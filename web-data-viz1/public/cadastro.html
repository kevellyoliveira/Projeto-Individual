<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>FavStyle | Cadastro</title>

  <script src="./js/sessao.js"></script>

  <link rel="stylesheet" href="./css/cadastro.css" />
  <link rel="icon" href="img/logoFav.png">
  <link rel="preconnect" href="https://fonts.gstatic.com" />
</head>

<body onload="listar()">
  <!--header inicio-->
  <div class="header">
    <div class="container">
      <div class="logo">
        <svg width="74" height="51" viewBox="0 0 204 161" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M139.956 40.2445C139.731 40.4688 139.563 42.3751 139.563 44.5057V48.3743L137.769 48.094C130.144 46.8044 110.856 45.2345 109.567 45.7392C108.838 46.0195 108.67 46.9166 108.726 50.6731C108.782 53.2523 108.782 55.6632 108.782 55.9996C108.726 56.5603 104.465 56.7285 89.4944 56.7285C75.3092 56.7285 70.0949 56.8967 69.5903 57.4013C68.6932 58.2984 68.6932 65.8115 69.5903 66.7086C69.9827 67.101 71.2162 67.3814 72.3937 67.3814H74.5242V79.7724V92.1634L68.8053 91.6588C65.6094 91.4345 60.8997 91.2103 58.2645 91.2103H53.4988L53.2184 101.583L52.9381 111.955L47.7238 112.124L42.5655 112.292V128.776V145.204L41.1077 146.942C39.5939 148.736 39.65 150.586 41.1638 150.25C41.6123 150.138 44.8643 146.269 48.4526 141.671C55.4611 132.644 59.1055 129.336 65.5534 126.141C69.7024 124.066 70.992 124.01 87.7002 124.795C98.9138 125.3 98.9699 125.3 100.82 119.581C103.287 111.843 107.324 109.376 119.603 108.255C126.107 107.638 131.657 106.797 134.629 106.012C137.208 105.339 139.395 102.872 141.974 97.602C143.207 95.1911 144.833 92.8362 145.955 91.9392C147.749 90.4814 148.982 89.9207 155.262 87.7341C156.664 87.2294 158.346 86.3324 159.075 85.7156L160.308 84.5942V115.207C160.308 133.71 160.532 146.381 160.869 147.222C161.149 148.007 161.766 148.68 162.271 148.68C162.999 148.68 163.112 144.643 163.112 113.357C163.112 82.4637 162.999 78.0343 162.271 78.0343C161.822 78.0343 161.093 78.8753 160.645 79.8845C159.86 81.8469 156.103 85.3231 154.87 85.3231C154.309 85.3231 154.141 81.5666 154.141 67.6057V49.8882L152.459 49.2714C150.889 48.6547 150.833 48.5425 150.665 44.3935L150.496 40.1884L145.45 40.0202C142.647 39.9642 140.18 40.0202 139.956 40.2445ZM147.973 45.4027C147.973 49.0472 147.917 49.1032 143.936 48.5425C141.806 48.2061 141.806 48.2061 141.806 45.5709C141.806 44.1132 141.974 42.7115 142.198 42.5433C142.366 42.319 143.768 42.1508 145.282 42.1508H147.973V45.4027ZM122.518 48.879C127.452 49.4957 133.62 50.1125 136.255 50.2807C138.834 50.3928 143.32 50.8413 146.179 51.1777L151.337 51.7945V69.0634V86.2763L148.422 87.6219C146.852 88.3508 144.441 90.0328 143.151 91.3785L140.741 93.7894L140.572 84.9307L140.404 76.0719L127.677 75.9037L114.893 75.7916V71.6425C114.893 67.9981 115.005 67.4935 116.015 67.2132C117.024 66.9328 117.136 66.4282 117.136 62.1671C117.136 56.9527 117.024 56.7285 113.435 56.7285H111.529V52.243C111.529 48.3183 111.641 47.7576 112.538 47.7576C113.099 47.7576 117.584 48.2622 122.518 48.879ZM114.893 62.0549V64.578H93.307H71.7208V62.0549V59.5319H93.307H114.893V62.0549ZM112.09 71.5865V75.7916H106.819H101.549L101.157 79.0996C100.932 80.8938 100.876 84.8746 100.988 87.9023L101.157 93.453L98.0728 93.6212C96.3907 93.7333 91.0082 93.5091 86.1864 93.1726L77.3276 92.4438V79.9406V67.3814H94.7087H112.09V71.5865ZM137.881 89.2479V100.461L136.367 102.144C134.909 103.713 134.405 103.938 129.471 104.442C126.555 104.723 121.79 105.339 118.986 105.788C116.127 106.236 113.099 106.629 112.258 106.629C111.361 106.629 109.118 107.358 107.212 108.311L103.68 109.937V94.3501C103.68 85.7717 103.848 78.595 104.016 78.4268C104.24 78.2025 111.922 78.0343 121.117 78.0343H137.881V89.2479ZM68.3568 94.294C71.889 94.5743 77.3276 94.9668 80.4114 95.135C87.9245 95.5275 100.54 96.5928 100.764 96.8171C100.876 96.9292 101.044 100.349 101.1 104.498C101.213 109.601 100.988 112.516 100.54 113.694L99.8109 115.488L95.9983 114.759C93.9238 114.366 90.5597 113.637 88.5412 113.189C86.5228 112.684 81.8691 111.619 78.1687 110.834C74.4682 109.993 68.9174 108.76 65.8337 108.031C62.75 107.302 59.2738 106.517 58.1524 106.349L56.0218 106.012V99.5644V93.1166L58.9934 93.3969C60.5633 93.5651 64.8245 93.9576 68.3568 94.294ZM63.0303 109.937C65.8337 110.554 70.992 111.731 74.5242 112.516C78.0565 113.301 83.1026 114.422 85.7378 115.039C88.373 115.6 92.2417 116.497 94.3723 117.002C96.5029 117.45 98.3531 117.955 98.4653 118.011C98.5774 118.123 98.2971 119.188 97.8485 120.422L97.1196 122.608H89.6065C85.4575 122.608 80.2432 122.216 77.9444 121.767C74.1878 121.094 73.4589 121.094 69.8145 121.992C65.8898 123.001 63.0303 124.402 58.4327 127.486L56.0218 129.112V118.684C56.0218 108.984 56.0779 108.255 57.031 108.535C57.5356 108.647 60.283 109.32 63.0303 109.937ZM53.2184 123.113V131.691L50.1347 135.56C48.4526 137.691 46.6024 140.045 45.9856 140.83L44.8643 142.232L44.8082 128.327V114.478H49.0133H53.2184V123.113Z" fill="#E2AA44"/>
          <path d="M131.545 57.0649C131.321 57.2892 131.153 59.9804 131.153 63.0081V68.5027H137.04H142.983L142.815 62.7277L142.647 57.0088L137.32 56.8406C134.349 56.7845 131.77 56.8406 131.545 57.0649ZM140.124 62.896V66.26H136.76H133.396V62.896V59.5319H136.76H140.124V62.896Z" fill="#E2AA44"/>
          <path d="M83.8316 72.3714C83.327 73.1003 83.2709 81.6787 83.7194 82.4636C84.168 83.1925 91.7932 83.3047 92.9146 82.6318C93.4192 82.2954 93.5874 80.7816 93.4753 77.1372L93.307 72.1471L88.7095 71.9789C86.1864 71.9229 83.9998 72.035 83.8316 72.3714ZM90.784 77.1933V80.277H88.2609H85.7379V77.1933V74.1095H88.2609H90.784V77.1933Z" fill="#E2AA44"/>
          <path d="M111.361 87.9023C111.137 88.1265 110.969 90.3132 110.969 92.7241V97.1535L115.061 96.9853L119.098 96.8171V92.3316V87.8462L115.454 87.678C113.435 87.5659 111.585 87.678 111.361 87.9023ZM117.024 92.1634C117.192 94.2379 117.192 94.294 115.23 94.294C113.267 94.294 113.211 94.2379 113.211 91.9952C113.211 89.8086 113.267 89.7525 115.061 89.9207C116.687 90.0889 116.856 90.2571 117.024 92.1634Z" fill="#E2AA44"/>
          <path d="M83.439 100.293C83.3269 101.134 83.3269 103.265 83.4951 104.947L83.7754 108.031L86.5227 108.199C88.0366 108.311 89.8868 108.255 90.6157 108.031C91.9053 107.75 91.9613 107.526 91.7931 103.377L91.6249 99.0598L87.6441 98.8916L83.6072 98.7234L83.439 100.293ZM89.6625 103.265C89.6625 105.452 89.6065 105.508 87.7002 105.508C85.7938 105.508 85.7378 105.452 85.7378 103.265C85.7378 101.078 85.7938 101.022 87.7002 101.022C89.6065 101.022 89.6625 101.078 89.6625 103.265Z" fill="#E2AA44"/>
          <path d="M154.982 91.7709C151.337 93.2848 149.095 96.9292 149.768 100.293C150.104 102.2 151.562 101.415 151.954 99.1158C152.347 96.8171 155.038 93.7333 156.664 93.7333C157.505 93.7333 157.841 91.7709 157.056 91.2663C156.832 91.1542 155.879 91.3785 154.982 91.7709Z" fill="#E2AA44"/>
          <path d="M143.095 114.03C140.853 116.497 140.18 118.179 139.843 122.048L139.451 126.028L135.975 126.982C134.124 127.542 130.929 129 128.91 130.178C124.761 132.644 118.818 137.747 118.818 138.868C118.818 140.55 120.388 139.877 124.425 136.513C129.471 132.196 133.676 129.953 138.161 129.112C139.955 128.776 141.469 128.495 141.525 128.495C141.581 128.495 141.806 126.645 141.974 124.403C142.31 119.749 143.432 116.721 145.226 115.488C146.067 114.983 146.347 114.366 146.123 113.75C145.618 112.46 144.441 112.572 143.095 114.03Z" fill="#E2AA44"/>
          <path d="M74.2438 135.055C69.478 137.018 63.3105 141.896 63.3105 143.69C63.3105 145.652 64.544 145.372 67.2914 142.681C70.1508 139.877 75.0848 136.906 76.8229 136.906C78.561 136.906 79.5703 136.233 79.5703 135.168C79.5703 133.822 77.4397 133.766 74.2438 135.055Z" fill="#E2AA44"/>
        </svg>
        
        <h1 class="titulo">FavStyle</h1>
          </div>      
        
         <ul class="navbar">
        <li>
          <a href="index.html">Home</a>
        </li>
       
        <li>
          <a href="sobreNos.html">Sobre Nós</a>
        </li>
      
        <li>
          <a href="estilos.html">Estilos</a>
        </li>
      </ul>

        <ul class="navbar1">
        <li>
          <a href="login.html">Login</a>
        </li>
        <li class="agora">
          <a href="cadastro.html">Cadastro</a>
        </li>
      </ul>
    </div>
  </div>
  <!--header fim-->

  <div class="login">
    <div class="alerta_erro">
      <div class="card_erro" id="cardErro">
        <span id="mensagem_erro"></span>
      </div>
    </div>
    <div class="container">
      <div class="card card-cadastro">
        <h2>Bem-vindo!</h2>
        <div class="formulario">
          <!--
                         Para inserir mais um campo, copie uma das inputs abaixo.
                         Assim que inserir vá para o script abaixo.
                     -->
          <div class="campo">
            <span>Empresa:</span>
            <select name="empresas" id="listaEmpresas">
              <option selected>Selecione um estilo</option>
            </select>
          </div>
          <div class="campo">
            <span>Nome:</span>
            <input id="nome_input" type="text" placeholder="Seu nome" />
          </div>
          <span>Foto: </span>
          <label id="foto">
            Adicionar foto
            <input name="foto" id="foto" maxlength="100" type="file">
        </label>
          <div class="campo">
            <span>Data de nascimento:</span>
            <input id="dtNasc_input" type="date" placeholder="17/08/2005" />
          </div>

          <div class="campo">
            <span>E-mail:</span>
            <input id="email_input" type="text" placeholder="meuemail@provedor.com" />
          </div>
          <div class="campo">
            <span>Senha:</span>
            <input id="senha_input" type="password" placeholder="******" />
          </div>
          <div class="campo">
            <span>Confirmação da Senha:</span>
            <input id="confirmacao_senha_input" type="password" placeholder="******" />
          </div>
          <button class="botao" onclick="cadastrar()">Cadastrar</button>
        </div>
        <div id="div_aguardar" class="loading-div">
          <img src="https://www.wpfaster.org/wp-content/uploads/2013/06/circle-loading-gif.gif" id="loading-gif" />
        </div>

        <div id="div_erros_login"></div>
      </div>
    </div>
  </div>

  <!--footer inicio-->
  <!-- <div class="footer">
    <div class="container">
      <h4>Feito com amor por aluno &hearts; SPTech &copy; 2023</h4>
      <span class="version">v1.0.0</span>
    </div>
  </div> -->
  <!--footer fim-->
</body>

</html>

<script>

function cadastrar() {
    //Recupere o valor da nova input pelo nome do id
    var nomeVar = nome_input.value;
    var dtNascVar = dtNasc_input.value;
    var emailVar = email_input.value;
    var senhaVar = senha_input.value;
    var confirmacaoSenhaVar = confirmacao_senha_input.value;
    var empresaVar = listaEmpresas.value;

    // Validações
    var termina_com_com = emailVar.endsWith(".com");
    var indice_arroba = emailVar.indexOf("@");

    if (!termina_com_com) {
        cardErro.style.display = "block";
        mensagem_erro.innerHTML = "(Seu email não possui '.com')";
        finalizarAguardar();
        return false;
    }

    if (indice_arroba < 0) {
        cardErro.style.display = "block";
        mensagem_erro.innerHTML = "(Seu email não possui '@')";
        finalizarAguardar();
        return false;
    }

    if (nomeVar.length <= 1) {
        cardErro.style.display = "block";
        mensagem_erro.innerHTML = "(Seu nome deve ter mais de 1 caractere)";
        finalizarAguardar();
        return false;
    }

    if (dtNascVar.length != 10) { // Ajuste o comprimento da data conforme o formato esperado (yyyy-mm-dd)
        cardErro.style.display = "block";
        mensagem_erro.innerHTML = "(A quantidade de caracteres da data de nascimento é inválida)";
        finalizarAguardar();
        return false;
    }

    if (senhaVar !== confirmacaoSenhaVar) {
        cardErro.style.display = "block";
        mensagem_erro.innerHTML = "(Divergência de senhas! Tente novamente)";
        finalizarAguardar();
        return false;
    }

    if (senhaVar.length <= 6) {
        cardErro.style.display = "block";
        mensagem_erro.innerHTML = "(A senha deve ter mais de 6 caracteres)";
        finalizarAguardar();
        return false;
    }

    if (nomeVar === "" || dtNascVar === "" || emailVar === "" || senhaVar === "" || confirmacaoSenhaVar === "" || empresaVar === "") {
        cardErro.style.display = "block";
        mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";
        return false;
    } else {
        setInterval(sumirMensagem, 5000);
    }

    // Criar um FormData e adicionar todos os campos
    const formData = new FormData();
    formData.append('nome', nomeVar);
    formData.append('dtNasc', dtNascVar);
    formData.append('email', emailVar);
    formData.append('senha', senhaVar);
    formData.append('confirmacaoSenha', confirmacaoSenhaVar);
    formData.append('empresa', empresaVar);
    formData.append('foto', foto.files[0]); // Adicionando a foto

    // Enviar a requisição com o FormData
    fetch("/usuarios/cadastrar", {
        method: "POST",
        body: formData
    })
    .then(function(resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

            setTimeout(() => {
                window.location = "login.html";
            }, 2000);

            limparFormulario();
            finalizarAguardar();
        } else {
            resposta.text().then(texto => {
                mensagem_erro.innerHTML = `Erro: ${texto}`;
            });
            throw "Houve um erro ao tentar realizar o cadastro!";
        }
    })
    .catch(function(erro) {
        console.log(`#ERRO: ${erro}`);
        finalizarAguardar();
    });

    return false;
}

  function listar() {
    fetch("/empresas/listar", {
      method: "GET",
    })
      .then(function (resposta) {
        resposta.json().then((empresas) => {
          empresas.forEach((estilo) => {
            listaEmpresas.innerHTML += `<option value='${estilo.idEstilo}'>${estilo.nome}</option>`;
          });
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function sumirMensagem() {
    cardErro.style.display = "none";
  }
</script>